<mxfile host="Electron" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/28.2.8 Chrome/140.0.7339.240 Electron/38.4.0 Safari/537.36" version="28.2.8">
  <diagram name="State Machine Architecture" id="state-machine-arch">
    <mxGraphModel dx="1598" dy="924" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="Phoenix SDR State Machine Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="350" y="10" width="500" height="40" as="geometry" />
        </mxCell>
        <mxCell id="hw-interrupts-container" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3f4f6;strokeColor=#9ca3af;strokeWidth=2;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="150" y="50" width="850" height="100" as="geometry" />
        </mxCell>
        <mxCell id="hw-interrupts-label" value="Hardware Interrupts" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="450" y="60" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ptt-button" value="PTT Button&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;iPTT_PRESSED/&lt;br&gt;RELEASED&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;strokeWidth=2;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="180" y="90" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cw-keys" value="CW Keys 1/2&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;iKEY1/2_PRESSED/&lt;br&gt;RELEASED&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;strokeWidth=2;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="340" y="90" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="encoders" value="Encoders&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;iXYZ_INCREASE/&lt;br&gt;DECREASE&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;strokeWidth=2;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="500" y="90" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="front-panel" value="Front Panel&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;iBUTTON_&lt;br&gt;PRESSED&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;strokeWidth=2;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="660" y="90" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="timer" value="1ms Timer&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;TimerInterrupt()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;strokeWidth=2;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="820" y="90" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="interrupt-fifo" value="Interrupt FIFO (16-entry circular buffer)&lt;br&gt;&lt;font style=&quot;font-size:11px&quot;&gt;SetInterrupt() → Queue events | GetInterrupt() → Dequeue&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Special: PrependInterrupt() for CW keyer memory&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#f59e0b;strokeWidth=2;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="400" y="180" width="400" height="70" as="geometry" />
        </mxCell>
        <mxCell id="arrow-ptt-fifo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.2;entryY=0;entryDx=0;entryDy=0;strokeColor=#3b82f6;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="ptt-button" target="interrupt-fifo" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="250" y="160" />
              <mxPoint x="480" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-keys-fifo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.35;entryY=0;entryDx=0;entryDy=0;strokeColor=#3b82f6;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="cw-keys" target="interrupt-fifo" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="410" y="150" />
              <mxPoint x="540" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-enc-fifo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#3b82f6;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="encoders" target="interrupt-fifo" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-panel-fifo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.65;entryY=0;entryDx=0;entryDy=0;strokeColor=#3b82f6;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="front-panel" target="interrupt-fifo" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="main-loop" value="&lt;b&gt;Main Loop (Loop.cpp)&lt;/b&gt;&lt;br&gt;Event Orchestrator&lt;br&gt;&lt;br&gt;1. Handle Interrupts&lt;br&gt;2. Perform Signal Processing&lt;br&gt;3. Update Display&lt;br&gt;&lt;br&gt;&lt;font color=&quot;#dc2626&quot;&gt;&lt;b&gt;Must complete &amp;lt; 10ms&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2fe;strokeColor=#0284c7;strokeWidth=3;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="50" y="290" width="240" height="140" as="geometry" />
        </mxCell>
        <mxCell id="arrow-fifo-mainloop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.895;entryY=-0.005;entryDx=0;entryDy=0;strokeColor=#f59e0b;strokeWidth=3;endArrow=block;endFill=1;entryPerimeter=0;" parent="1" source="interrupt-fifo" target="main-loop" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-fifo-mainloop-label" value="GetInterrupt()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#ea580c;" parent="arrow-fifo-mainloop" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="28" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uism" value="&lt;b&gt;UISm (UISm.cpp)&lt;/b&gt;&lt;br&gt;User Interface Controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ede9fe;strokeColor=#8b5cf6;strokeWidth=3;fontSize=14;verticalAlign=top;spacingTop=10;" parent="1" vertex="1">
          <mxGeometry x="800" y="290" width="340" height="200" as="geometry" />
        </mxCell>
        <mxCell id="uism-states" value="&lt;b&gt;Key States:&lt;/b&gt;&lt;br&gt;• SPLASH (boot screen)&lt;br&gt;• HOME (main display)&lt;br&gt;• MAIN_MENU&lt;br&gt;• SECONDARY_MENU&lt;br&gt;• UPDATE (parameter edit)&lt;br&gt;• CALIBRATION" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#7c3aed;strokeWidth=1;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;" parent="1" vertex="1">
          <mxGeometry x="820" y="345" width="280" height="125" as="geometry" />
        </mxCell>
        <mxCell id="arrow-mainloop-modesm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3;exitDx=0;exitDy=0;entryX=0;entryY=0.207;entryDx=0;entryDy=0;strokeColor=#ec4899;strokeWidth=3;endArrow=block;endFill=1;entryPerimeter=0;" parent="1" source="main-loop" target="modesm" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-mainloop-uism" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.7;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#8b5cf6;strokeWidth=3;endArrow=block;endFill=1;" parent="1" source="main-loop" target="uism" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-timer-modesm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.8;entryY=0;entryDx=0;entryDy=0;strokeColor=#16a34a;strokeWidth=2;endArrow=block;endFill=1;dashed=1;" parent="1" source="timer" target="modesm" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="890" y="270" />
              <mxPoint x="672" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-timer-modesm-label" value="1ms DO events" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#16a34a;" parent="arrow-timer-modesm" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="67" y="-12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-timer-uism" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#16a34a;strokeWidth=2;endArrow=block;endFill=1;dashed=1;" parent="1" source="timer" target="uism" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="890" y="270" />
              <mxPoint x="970" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yZ03nLWbBo4yx16Ja4qs-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;strokeColor=#dc2626;strokeWidth=3;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=block;endFill=1;" edge="1" parent="1" source="hardwaresm" target="rf-hardware">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hardwaresm" value="&lt;b&gt;Hardware State (HardwareSM.cpp)&lt;/b&gt;&lt;br&gt;RF Hardware Configuration Bridge" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#10b981;strokeWidth=3;fontSize=14;verticalAlign=top;spacingTop=10;" parent="1" vertex="1">
          <mxGeometry x="585" y="540" width="340" height="180" as="geometry" />
        </mxCell>
        <mxCell id="hardwaresm-states" value="&lt;b&gt;RF Hardware States:&lt;/b&gt;&lt;br&gt;• RFReceive&lt;br&gt;• RFTransmit (SSB)&lt;br&gt;• RFCWMark (carrier ON)&lt;br&gt;• RFCWSpace (carrier OFF)&lt;br&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Maps ModeSm states → Hardware config&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#059669;strokeWidth=1;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;" parent="1" vertex="1">
          <mxGeometry x="605" y="595" width="280" height="115" as="geometry" />
        </mxCell>
        <mxCell id="arrow-modesm-hardwaresm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#10b981;strokeWidth=3;endArrow=block;endFill=1;" parent="1" source="modesm" target="hardwaresm" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tune-state" value="&lt;b style=&quot;font-family: Helvetica; font-size: 14px;&quot;&gt;Tune State (Tune.cpp)&lt;/b&gt;&lt;br style=&quot;font-family: Helvetica; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-family: Helvetica; font-size: 14px;&quot;&gt;VFO Frequency Management&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef9c3;strokeColor=#eab308;strokeWidth=2;fontSize=11;align=center;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;" parent="1" vertex="1">
          <mxGeometry x="235" y="540" width="300" height="180" as="geometry" />
        </mxCell>
        <mxCell id="rf-hardware" value="&lt;b&gt;RF Hardware and DSP&lt;/b&gt;&lt;br&gt;&lt;br&gt;• VFO Control (Si5351)&lt;br&gt;• Antenna/Relay Control&lt;br&gt;• Filter Selection&lt;br&gt;• DSP Configuration&lt;div&gt;...&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fee2e2;strokeColor=#dc2626;strokeWidth=2;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;" parent="1" vertex="1">
          <mxGeometry x="470" y="780" width="190" height="110" as="geometry" />
        </mxCell>
        <mxCell id="arrow-tune-rfhw" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.2;entryY=0;entryDx=0;entryDy=0;strokeColor=#dc2626;strokeWidth=3;endArrow=block;endFill=1;" parent="1" source="tune-state" target="rf-hardware" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="shared-state" value="&lt;b&gt;Shared Global Configuration Settings&lt;/b&gt;&lt;br&gt;&lt;br&gt;EEPROMData ED:&lt;br&gt;• centerFreq_Hz&lt;br&gt;• activeVFO, currentBand&lt;br&gt;• modulation, keyType&lt;br&gt;..." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;strokeWidth=2;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;dashed=1;dashPattern=3 3;" parent="1" vertex="1">
          <mxGeometry x="75" y="770" width="205" height="110" as="geometry" />
        </mxCell>
        <mxCell id="yZ03nLWbBo4yx16Ja4qs-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#eab308;strokeWidth=3;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=block;endFill=1;" edge="1" parent="1" source="modesm" target="tune-state">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="modesm" value="&lt;b&gt;ModeSm (ModeSm.cpp)&lt;/b&gt;&lt;br&gt;Radio Operating Mode Controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#ec4899;strokeWidth=3;fontSize=14;verticalAlign=top;spacingTop=10;" parent="1" vertex="1">
          <mxGeometry x="400" y="290" width="340" height="200" as="geometry" />
        </mxCell>
        <mxCell id="modesm-states" value="&lt;b&gt;Key States:&lt;/b&gt;&lt;br&gt;• SSB_RECEIVE&lt;br&gt;• SSB_TRANSMIT&lt;br&gt;• CW_RECEIVE&lt;br&gt;• CW_TRANSMIT_MARK&lt;br&gt;• CW_TRANSMIT_SPACE&lt;br&gt;• CW_TRANSMIT_DIT/DAH_MARK&lt;br&gt;• CALIBRATE_* states" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#db2777;strokeWidth=1;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;" parent="1" vertex="1">
          <mxGeometry x="420" y="345" width="280" height="125" as="geometry" />
        </mxCell>
        <mxCell id="yZ03nLWbBo4yx16Ja4qs-1" value="&lt;b&gt;Tune States:&lt;/b&gt;&lt;br&gt;• TuneReceive&lt;br&gt;• TuneSSBTX&lt;br&gt;• TuneCWTX (with tone offset)&lt;br&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Maps ModeSm states &amp;amp;&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;font-size: 10px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;global settings → Tune config&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#059669;strokeWidth=1;fontSize=11;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=monospace;" vertex="1" parent="1">
          <mxGeometry x="245" y="590" width="280" height="115" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
